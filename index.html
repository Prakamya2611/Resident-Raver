<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Resident Raver</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
  body { background: #05030d; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; }
  #gameBox { text-align: center; }
  canvas { background: radial-gradient(circle at top, #3a1f5d 0, #050510 60%); border: 3px solid #3f3fff; border-radius: 10px; margin-top: 12px; }
  button {
    background: linear-gradient(90deg, #ff0077, #ffe600);
    padding: 8px 20px;
    border: none;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
  }
</style>
</head>

<body>
<div id="gameBox">
  <h1>Resident Raver</h1>
  <p>Collect beats and avoid angry neighbours!</p>
  <canvas id="game" width="480" height="640"></canvas>
  <p>Score: <span id="score">0</span></p>
  <button onclick="startGame()">Start Game</button>
  <p>Controls: ← → arrows, SPACE = Dash</p>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let player = { x: 220, y: 560, w: 40, h: 40, speed: 5, dash: 10 };
let beats = [];
let enemies = [];
let score = 0;
let running = false;
let keys = {};

document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function startGame() {
  score = 0;
  beats = [];
  enemies = [];
  running = true;
  loop();
}

function spawnBeat() {
  beats.push({ x: Math.random()*440, y: -20, r: 10 });
}

function spawnEnemy() {
  enemies.push({ x: Math.random()*440, y: -20, s: 22 });
}

function update() {
  if (!running) return;

  // Movement
  if (keys["ArrowLeft"]) player.x -= keys[" "] ? player.dash : player.speed;
  if (keys["ArrowRight"]) player.x += keys[" "] ? player.dash : player.speed;
  if (player.x < 0) player.x = 0;
  if (player.x > 440) player.x = 440;

  // Spawn objects
  if (Math.random() < 0.04) spawnBeat();
  if (Math.random() < 0.03) spawnEnemy();

  // Update beats
  for (let i = beats.length - 1; i >= 0; i--) {
    beats[i].y += 3;
    if (beats[i].y > 660) beats.splice(i, 1);
    else if (hit(player, beats[i].x, beats[i].y, 20, 20)) {
      score += 10;
      beats.splice(i, 1);
      document.getElementById("score").textContent = score;
    }
  }

  // Update enemies
  for (let i = enemies.length - 1; i >= 0; i--) {
    enemies[i].y += 4;
    if (enemies[i].y > 660) enemies.splice(i, 1);
    else if (hit(player, enemies[i].x, enemies[i].y, 22, 22)) {
      running = false;   // Game Over
      alert("Neighbours complained! Final score: " + score);
    }
  }
}

function hit(p, x, y, w, h) {
  return p.x < x + w && p.x + p.w > x && p.y < y + h && p.y + p.h > y;
}

function draw() {
  ctx.clearRect(0, 0, 480, 640);

  // Player
  ctx.fillStyle = "#00ffee";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // Beats
  ctx.fillStyle = "#ff00ff";
  beats.forEach(b => ctx.beginPath() || ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2) || ctx.fill());

  // Enemies
  ctx.fillStyle = "#ff4444";
  enemies.forEach(e => ctx.fillRect(e.x, e.y, e.s, e.s));
}

function loop() {
  if (!running) return;
  update();
  draw();
  requestAnimationFrame(loop);
}
</script>
</body>
</html>
