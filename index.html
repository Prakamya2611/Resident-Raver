<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Resident Raver – Corridor Level</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    #wrapper { text-align: center; }
    canvas {
      border: 2px solid #333;
      display: block;
      margin: 8px auto;
      background: #000;
    }
    #info { font-size: 13px; color: #ccc; }
  </style>
</head>
<body>
<div id="wrapper">
  <h2>Resident Raver</h2>
  <div id="info">Controls: ← → move, ↑ / Space jump</div>
  <canvas id="game" width="800" height="300"></canvas>
</div>

<script>
// ====== CANVAS SETUP ======
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ====== TILE MAP (simple dorm corridor) ======
// 0 = empty, 1 = wall/solid, 2 = floor, 3 = door, 4 = window
const TILE = 32;
const LEVEL_ROWS = 10;
const LEVEL_COLS = 30;

// a simple map roughly like the screenshot
const map = [
  // 0         5         10        15        20        25
  //012345678901234567890123456789
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], // top bricks
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,4,0,0,0,3,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1], // floor
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]  // bottom solid
];

// which tiles are solid (collide)
function isSolidTile(code) {
  return code === 1 || code === 2; // walls + floor
}

// ====== PLAYER ======
const player = {
  x: 60,
  y: 180,
  w: 22,
  h: 30,
  vx: 0,
  vy: 0,
  speed: 2.5,
  jumpForce: -7,
  onGround: false,
};

const GRAVITY = 0.35;
const FRICTION = 0.8;

// ====== INPUT ======
const keys = {};
window.addEventListener("keydown", e => {
  keys[e.code] = true;
});
window.addEventListener("keyup", e => {
  keys[e.code] = false;
});

// ====== COLLISION HELPERS ======
function getTileAtPixel(px, py) {
  const tx = Math.floor(px / TILE);
  const ty = Math.floor(py / TILE);
  if (tx < 0 || ty < 0 || tx >= LEVEL_COLS || ty >= LEVEL_ROWS) return 1; // outside = solid
  return map[ty][tx];
}

function resolveCollisions(obj) {
  // Horizontal
  obj.x += obj.vx;
  if (obj.vx > 0) {
    // moving right
    const right = obj.x + obj.w;
    const top = obj.y + 2;
    const bottom = obj.y + obj.h - 2;
    if (isSolidTile(getTileAtPixel(right, top)) || isSolidTile(getTileAtPixel(right, bottom))) {
      obj.x = Math.floor((right) / TILE) * TILE - obj.w - 0.01;
      obj.vx = 0;
    }
  } else if (obj.vx < 0) {
    // moving left
    const left = obj.x;
    const top = obj.y + 2;
    const bottom = obj.y + obj.h - 2;
    if (isSolidTile(getTileAtPixel(left, top)) || isSolidTile(getTileAtPixel(left, bottom))) {
      obj.x = Math.floor(left / TILE + 1) * TILE + 0.01;
      obj.vx = 0;
    }
  }

  // Vertical
  obj.y += obj.vy;
  obj.onGround = false;
  if (obj.vy > 0) {
    // falling
    const bottom = obj.y + obj.h;
    const left = obj.x + 4;
    const right = obj.x + obj.w - 4;
    if (isSolidTile(getTileAtPixel(left, bottom)) || isSolidTile(getTileAtPixel(right, bottom))) {
      obj.y = Math.floor(bottom / TILE) * TILE - obj.h - 0.01;
      obj.vy = 0;
      obj.onGround = true;
    }
  } else if (obj.vy < 0) {
    // jumping up
    const top = obj.y;
    const left = obj.x + 4;
    const right = obj.x + obj.w - 4;
    if (isSolidTile(getTileAtPixel(left, top)) || isSolidTile(getTileAtPixel(right, top))) {
      obj.y = Math.floor(top / TILE + 1) * TILE + 0.01;
      obj.vy = 0;
    }
  }
}

// ====== UPDATE ======
function update() {
  // horizontal input
  if (keys["ArrowLeft"]) {
    player.vx = -player.speed;
  } else if (keys["ArrowRight"]) {
    player.vx = player.speed;
  } else {
    player.vx *= FRICTION;
    if (Math.abs(player.vx) < 0.05) player.vx = 0;
  }

  // jump
  if ((keys["ArrowUp"] || keys["Space"]) && player.onGround) {
    player.vy = player.jumpForce;
    player.onGround = false;
  }

  // gravity
  player.vy += GRAVITY;
  if (player.vy > 10) player.vy = 10;

  resolveCollisions(player);
}

// ====== DRAW MAP & PLAYER ======
function drawMap() {
  for (let y = 0; y < LEVEL_ROWS; y++) {
    for (let x = 0; x < LEVEL_COLS; x++) {
      const code = map[y][x];
      const px = x * TILE;
      const py = y * TILE;

      if (code === 1) {
        // brick wall
        ctx.fillStyle = "#5c3b2b";
        ctx.fillRect(px, py, TILE, TILE);
        ctx.strokeStyle = "#3c261b";
        ctx.strokeRect(px, py, TILE, TILE);
      } else if (code === 2) {
        // floor
        ctx.fillStyle = "#444";
        ctx.fillRect(px, py, TILE, TILE);
        ctx.fillStyle = "#a33";
        ctx.fillRect(px, py, TILE, 6);
      } else if (code === 3) {
        // door
        ctx.fillStyle = "#8b5a2b";
        ctx.fillRect(px + 4, py + 8, TILE - 8, TILE);
        ctx.fillStyle = "#cfa";
        ctx.fillRect(px + TILE - 12, py + 20, 6, 4); // handle
      } else if (code === 4) {
        // window
        ctx.fillStyle = "#222";
        ctx.fillRect(px + 4, py + 4, TILE - 8, TILE - 8);
        ctx.fillStyle = "#88c";
        ctx.fillRect(px + 6, py + 6, TILE - 12, TILE - 12);
        ctx.strokeStyle = "#222";
        ctx.beginPath();
        ctx.moveTo(px + 4, py + TILE / 2);
        ctx.lineTo(px + TILE - 4, py + TILE / 2);
        ctx.moveTo(px + TILE / 2, py + 4);
        ctx.lineTo(px + TILE / 2, py + TILE - 4);
        ctx.stroke();
      } else {
        // empty interior wall
        ctx.fillStyle = "#d6d6d6";
        ctx.fillRect(px, py, TILE, TILE);
      }
    }
  }

  // black outside walls
  ctx.fillStyle = "#000";
  ctx.fillRect(0, 0, canvas.width, TILE); // top strip
  ctx.fillRect(0, canvas.height - TILE, canvas.width, TILE); // bottom strip
}

// simple pixel hero
function drawPlayer() {
  const p = player;
  // body
  ctx.fillStyle = "#f4d03f";
  ctx.fillRect(p.x, p.y, p.w, p.h - 10);
  // legs
  ctx.fillStyle = "#2e4053";
  ctx.fillRect(p.x, p.y + p.h - 10, p.w, 10);
  // head
  ctx.fillStyle = "#f5cba7";
  ctx.fillRect(p.x + 2, p.y - 10, p.w - 4, 10);
  // hat
  ctx.fillStyle = "#b03a2e";
  ctx.fillRect(p.x + 1, p.y - 14, p.w - 2, 4);
  ctx.fillRect(p.x - 2, p.y - 10, p.w + 4, 3);
}

// ====== MAIN LOOP ======
function loop() {
  update();
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawMap();
  drawPlayer();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
